<div id="{{viewport}}" class="pre-scrollable">

</div>

<script>
var count = 1;

function autoScroll() {
    console.log('it is now being executed', count);
    if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight * 60/100.0) {
        count = count + 1;
    
        $('#{{viewport}}').off('scroll');
    
        $.ajax({ 
        type: 'GET',
        url: "{% url 'jsim:jscroll-view' %}",
        async: false,
        data: {
            page : count,
            'jscroll-template': '{{template}}',
        },

        success: function(data) {
            $('#{{viewport}}').append(data.responseText);
            $('#{{viewport}}').on('scroll', autoScroll);
            console.log('Page ', count);
        },

        error: function(data) {
            $('#{{viewport}}').off('scroll');
            console.log('Page error', count);
        }});
    }
}

$.get({ 
url: "{% url 'jsim:jscroll-view' %}",
data: {
page : 1,
'jscroll-template': '{{template}}',
}},

function(data) {
$('#{{viewport}}').html('');
$('#{{viewport}}').append(data);
$('#{{viewport}}').on('scroll', autoScroll);
    console.log('this is fucking odd', count);

});


</script>

